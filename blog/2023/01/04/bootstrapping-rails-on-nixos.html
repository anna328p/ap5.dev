<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"/><meta content="public; max-age=86400" http-equiv="Cache-Control"/><meta content="width=device-width, initial-scale=1.0" name="viewport"/><link href="https://fonts.googleapis.com" rel="preconnect"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400;1,700&amp;display=swap" onload="this.onload=null;this.rel=&#39;stylesheet&#39;" rel="preload"/><noscript><link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:ital,wght@0,400;0,600;0,700;1,400;1,700&amp;display=swap" rel="stylesheet"/></noscript><link as="style" href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" onload="this.onload=null;this.rel=&#39;stylesheet&#39;" rel="preload"/><noscript><link href="https://fonts.googleapis.com/css2?family=Source+Code+Pro:ital,wght@0,400;0,700;1,400;1,700&amp;display=swap" rel="stylesheet"/></noscript><link href="/assets/css/style.css" rel="stylesheet"/><title>Bootstrapping Rails on NixOS - Blog - Anna Kudriavtsev</title><meta content="recently tried to start a Rails project on NixOS, realized that there was no obvious way to start a new one, even though it seemed fairly straightforward to work on an existing project. [‚Ä¶]" name="description"/><meta content="https://ap5.dev/assets/images/avatar-circle.png" name="image"/><meta content="Bootstrapping Rails on NixOS" itemprop="name"/><meta content="recently tried to start a Rails project on NixOS, realized that there was no obvious way to start a new one, even though it seemed fairly straightforward to work on an existing project. [‚Ä¶]" itemprop="description"/><meta content="https://ap5.dev/assets/images/avatar-circle.png" itemprop="image"/><meta content="summary" name="twitter:card"/><meta content="Bootstrapping Rails on NixOS" name="twitter:title"/><meta content="recently tried to start a Rails project on NixOS, realized that there was no obvious way to start a new one, even though it seemed fairly straightforward to work on an existing project. [‚Ä¶]" name="twitter:description"/><meta content="@anna328p" name="twitter:creator"/><meta content="https://ap5.dev/assets/images/avatar-circle.png" name="twitter:image:src"/><meta content="Bootstrapping Rails on NixOS" name="og:title"/><meta content="recently tried to start a Rails project on NixOS, realized that there was no obvious way to start a new one, even though it seemed fairly straightforward to work on an existing project. [‚Ä¶]" name="og:description"/><meta content="https://ap5.dev/assets/images/avatar-circle.png" name="og:image"/><meta content="https://ap5.dev/blog/2023/01/04/bootstrapping-rails-on-nixos" name="og:url"/><meta content="ap5.dev" name="og:site_name"/><meta content="website" name="og:type"/><link href="https://ap5.dev/assets/images/avatar-circle.png" rel="icon" type="image/png"/><script src="https://latest.cactus.chat/cactus.js" type="text/javascript"></script><link href="https://latest.cactus.chat/style.css" rel="stylesheet" type="text/css"/></head><body><div class="container page-container"><section><nav><p class="return-link-entry"><span class="return-link-pre">‚Üê</span><a class="return-link" href="/blog">Return to index</a></p></nav><article><header class="post-header"><h1 class="post-title">Bootstrapping Rails on NixOS</h1><p class="post-summary-header">by Anna at 2023-01-04 04:59:27 +0000</p><p class="post-license">license: CC BY-SA 4.0</p><p class="post-tag-list">(tags: <span class="post-tag">software</span>)</p></header><main class="page-main post-main"><p>recently tried to start a Rails project on NixOS, realized that there was no obvious way to start a new one, even though it seemed fairly straightforward to work on an existing project.</p> <p>i figured out a fairly simple process. i use direnv and flakes, and this process does too.</p> <p>first, create a project directory. enter it. create the following two files to set up a minimal flake:</p> <p><code class="language-plaintext highlighter-rouge">flake.nix</code></p> <div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="nv">description</span> <span class="o">=</span> <span class="s2">"TODO"</span><span class="p">;</span>

    <span class="nv">inputs</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nv">flake-utils</span><span class="o">.</span><span class="nv">url</span> <span class="o">=</span> <span class="nv">github</span><span class="p">:</span><span class="sx">numtide/flake-utils</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nv">outputs</span> <span class="o">=</span> <span class="p">{</span> <span class="nv">self</span>
        <span class="p">,</span> <span class="nv">nixpkgs</span>
        <span class="p">,</span> <span class="nv">flake-utils</span>
    <span class="p">}:</span> <span class="nv">flake-utils</span><span class="o">.</span><span class="nv">lib</span><span class="o">.</span><span class="nv">eachDefaultSystem</span> <span class="p">(</span><span class="nv">system</span><span class="p">:</span> <span class="kd">let</span>
        <span class="nv">pkgs</span> <span class="o">=</span> <span class="nv">nixpkgs</span><span class="o">.</span><span class="nv">legacyPackages</span><span class="o">.</span><span class="p">${</span><span class="nv">system</span><span class="p">};</span>

        <span class="nv">pkg</span> <span class="o">=</span> <span class="nv">pkgs</span><span class="o">.</span><span class="nv">callPackage</span> <span class="sx">./default.nix</span> <span class="p">{</span> <span class="p">};</span>
    <span class="kn">in</span> <span class="p">{</span>
        <span class="nv">packages</span><span class="o">.</span><span class="nv">default</span> <span class="o">=</span> <span class="nv">pkg</span><span class="p">;</span>
    <span class="p">});</span>
<span class="p">}</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">default.nix</code></p> <div class="language-nix highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span> <span class="nv">stdenv</span><span class="p">,</span> <span class="nv">ruby_3_1</span> <span class="p">}:</span>

<span class="nv">stdenv</span><span class="o">.</span><span class="nv">mkDerivation</span> <span class="p">{</span>
    <span class="nv">pname</span> <span class="o">=</span> <span class="s2">"TODO"</span><span class="p">;</span>
    <span class="nv">version</span> <span class="o">=</span> <span class="s2">"TODO"</span><span class="p">;</span>

    <span class="nv">nativeBuildInputs</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="nv">buildInputs</span> <span class="o">=</span> <span class="p">[</span> <span class="nv">ruby_3_1</span> <span class="p">];</span>
<span class="p">}</span>
</code></pre></div></div> <p>then, create an .envrc with the following content:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use flake
layout ruby
</code></pre></div></div> <p>run <code class="language-plaintext highlighter-rouge">direnv allow</code>.</p> <p>next, write a bootstrap Gemfile:</p> <div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">source</span> <span class="s1">'https://rubygems.org'</span>

<span class="n">gem</span> <span class="s1">'rails'</span>
</code></pre></div></div> <p>install locally by running <code class="language-plaintext highlighter-rouge">bundle install --path=vendor</code> (ignore the warnings for now)</p> <p>finally, run <code class="language-plaintext highlighter-rouge">bundle exec rails install .</code> and, when asked, overwrite the bootstrap gemfile with the upstream default.</p> </main></article></section><section class="col-footer"><footer class="site-footer">üÑØ Anna Kudriavtsev 2023<span class="divider"> &nbsp;|&nbsp; </span><a href="/LICENSE.txt">AGPLv3</a><span class="divider"> &nbsp;|&nbsp; </span><a href="https://github.com/anna328p/ap5.dev">Source code</a><span class="divider"> &nbsp;|&nbsp; </span><a href="/feed.xml">RSS feed</a></footer></section></div></body></html>